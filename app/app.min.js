angular.module("Roadmap",[]),angular.module("Roadmap").controller("DashboardController",["$scope","apiService","$timeout","$rootScope",function(a,b,c,d){a.init=function(b){a.projects=b},a.createNewProject=function(){b.createNewProject().then(function(a){console.log(a.data),window.location.href="/project/"+a.data._id})["catch"](function(a){console.error(a),alertify.error("There was a problem with your request...")})}}]),angular.module("Roadmap").controller("ProjectController",["$scope","apiService","$timeout","$rootScope",function(a,b,c,d){a.init=function(b,c){a.lists=b,a.colors=["blue","orange","purple","green"],a.project=c,localStorage.auth&&(a.auth=!0)},a.authenticate=function(b){"password"==b?(a.auth=!0,localStorage.auth=!0,alertify.success("Welcome!")):alertify.error("HAHAHA! You got it wrong!")},a.logOut=function(){delete localStorage.auth,window.location.reload()},a.renameProject=function(){alertify.prompt("Rename your project:",function(c,d){b.renameProject(a.project._id,c).then(function(b){a.project.name=c})["catch"](function(a){console.error(a),alertify.error("There was a problem with your request...")})})},a.createTask=function(c,d,e){var f=a.lists[e].tasks.length;b.createTask(c,d,f).then(function(b){a.newTask="",a.lists[e].tasks.push(b.data),a.editMode=!0,a.activateTask(b.data)})["catch"](function(a){console.error(a)})},a.createList=function(c){b.createList(c,a.project._id).then(function(b){a.lists.push(b.data)})["catch"](function(a){console.error(a)})},a.enableNewList=function(){a.newListEnabled=!0,c(function(){$("#new-list").focus()})},a.activateTask=function(b){a.modalOpen=!0,b.start=new Date(b.start),b.end=new Date(b.end),a.active=b},a.closeModal=function(){a.modalOpen=!1,a.editMode=!1},a.toggleEditMode=function(){a.editMode=!a.editMode},a.updateActive=function(c){a.editMode=!1,b.updateActive(c).then(function(b){a.lists=a.lists.map(function(a){return a.tasks=a.tasks.map(function(a){return a._id===c._id?b.data:a}),a}),d.$emit("task updated",a.lists),alertify.success("Successfully updated your task.")})["catch"](function(a){console.error(a),alertify.error("Ooops! There was an error.")})},a.deleteTask=function(c){alertify.confirm("Are you sure you want to delete this task?",function(){b.deleteTask(c._id).then(function(b){alertify.log("Task successfully removed"),a.lists=a.lists.map(function(a){return a.tasks=a.tasks.filter(function(a){return a._id!==c._id}),a}),d.$emit("task updated",a.lists),a.closeModal()})["catch"](function(a){console.error(a),alertify.error("There was a problem with your request.")})})},d.$on("timeline task clicked",function(b,c){a.activateTask(c),a.$digest()})}]),angular.module("Roadmap").factory("apiService",["$http",function(a){var b={};return b.createTask=function(b,c,d){var e={list_id:c,content:b,priority:d};return a.post("/api/task",e)},b.createList=function(b,c){return a.post("/api/list",{title:b,project:c})},b.updateActive=function(b){return a.put("/api/task/"+b._id,b)},b.deleteTask=function(b){return a["delete"]("/api/task/"+b)},b.reorderTasks=function(b){return a.put("/api/tasks/reorder",{data:b})},b.createNewProject=function(){return a.post("/api/project")},b.renameProject=function(b,c){return a.put("/api/project/rename/"+b,{name:c})},b}]),angular.module("Roadmap").directive("sortable",["apiService",function(a){return{restrict:"A",link:function(b,c,d){function e(b){console.log(b),a.reorderTasks(b).then(function(a){console.warn(a.data)})["catch"](function(a){console.error(a),alertify.error("There was an error re-ordering your tasks...")})}$.getScript("/scripts/jquery-ui.min.js",function(){$(".connectedSortable").sortable({tolerance:"touch",placeholder:"placeholder",connectWith:".connectedSortable",start:function(a,b){var c=$(b.item[0]).outerHeight();b.placeholder.css("height",c),b.item.addClass("selected")},stop:function(a,b){b.item.removeClass("selected"),$(".sortable").removeClass("grabbing")},receive:function(a,b){var c=$(".task-group");c=Array.prototype.slice.call(c);var d=c.map(function(a){var b=a.id.substring(5),c=$(a).find(".sortable");c=Array.prototype.slice.call(c);var d=c.map(function(a){return a.id.substring(5)});return{listId:b,taskIds:d}});e(d)}})})}}}]),angular.module("Roadmap").directive("sortable-tasks",["$timeout","apiService",function(a,b){return{restrict:"A",link:function(c,d,e){function f(a){b.reorderTasks(a).then(function(a){})["catch"](function(a){console.error(a),alertify.error("There was an error re-ordering your tasks...")})}console.log("hello"),a(function(){console.log("hello")},1e3),$.getScript("/scripts/jquery-ui.min.js",function(){$("#tasks").sortable({tolerance:"touch",stop:function(a){var b=$(".sortable");b=Array.prototype.slice.call(b);var c=b.map(function(a){return a.id.substring(5)});f(c),$(".sortable").removeClass("grabbing")}})})}}}]),angular.module("Roadmap").directive("timeline",["$rootScope",function(a){return{restrict:"A",scope:{lists:"="},link:function(b,c,d){function e(b){var c=["blue","orange","purple","green"],d=b.map(function(a){return{id:a._id,content:a.title}}),e=[];b.forEach(function(a,b){a.tasks.forEach(function(d){if(d.start)return d.className=c[b],d.id=d._id,d.title=d.content,d.group=a._id,e.push(d)})});var g=document.getElementById("visualization"),h=new vis.DataSet(e),i={max:new Date(2019,11,31),min:new Date(2018,0,1),zoomMax:31556952e3,zoomMin:12096e5};f=new vis.Timeline(g,h,d,i),f.on("click",function(b){var c=b.item;c&&a.$emit("timeline task clicked",f.itemsData._data[c])})}var f;e(b.lists),a.$on("task updated",function(a,b){f.destroy(b),e(b)})}}}]);